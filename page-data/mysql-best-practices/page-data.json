{"componentChunkName":"component---src-templates-blog-post-js","path":"/mysql-best-practices/","result":{"data":{"site":{"siteMetadata":{"title":"Reveries of a software engineer"}},"markdownRemark":{"id":"f1386922-958a-5b23-91b9-cb9d24461421","excerpt":"Access and Credential Security Command Line Password Security Avoid using passwords directly in command line: ⚠️ Warning: Using passwords in command line is…","html":"<h2>Access and Credential Security</h2>\n<h3>Command Line Password Security</h3>\n<p>Avoid using passwords directly in command line:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">mysql -u testuser -pMyP@ss0rd  <span class=\"token comment\"># Not recommended</span></code></pre></div>\n<p>⚠️ Warning: Using passwords in command line is insecure as they can be viewed in shell history.</p>\n<p>Better alternatives:</p>\n<ul>\n<li>Use <code class=\"language-text\">mysql_config_editor</code> for script automation</li>\n<li>Use password prompt</li>\n</ul>\n<h3>Strong Access Policy Recommendations</h3>\n<ol>\n<li>Implement <code class=\"language-text\">validate_password</code> plugin</li>\n<li>Limit user access by IP/IP range</li>\n<li>Follow principle of least privilege</li>\n<li>Create dedicated users for specific operations (e.g., backup user)</li>\n<li>Restrict FILE and SUPER privileges for remote users</li>\n<li>Use SSL for public network connections</li>\n</ol>\n<h2>Replication Best Practices</h2>\n<h3>Object Creation</h3>\n<ul>\n<li>Always use <code class=\"language-text\">IF EXISTS</code> and <code class=\"language-text\">IF NOT EXISTS</code> clauses</li>\n<li>Prevents common replication breaks from object conflicts</li>\n</ul>\n<h3>General Guidelines</h3>\n<p>Most common problem for replication break or errors is that OBJECT already exists on SLAVE. By using IF EXISTS and IF NOT EXISTS while creating database objects we can avoid.</p>\n<ul>\n<li>Enable GTID and crash-safe replication</li>\n<li>Keep slaves in read-only mode</li>\n<li>Run backups and query optimization on slaves</li>\n<li>Offload reporting queries to slaves</li>\n</ul>\n<h2>Logging</h2>\n<h3>Available Log Types</h3>\n<ol>\n<li><strong>Binary Log</strong>: Transaction records</li>\n<li><strong>Relay Log</strong>: Replication-related logs</li>\n<li><strong>General Log</strong>: Client command logging</li>\n<li><strong>Slow Query Log</strong>: Performance monitoring</li>\n<li><strong>Error Log</strong>: Server messages (NOTES, WARNINGS, ERRORS)</li>\n<li><strong>Audit Log</strong>: User activity tracking</li>\n</ol>\n<h2>Basic Administration Commands</h2>\n<h3>Database and Table Management</h3>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token comment\">-- Create database</span>\n<span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">DATABASE</span> <span class=\"token keyword\">IF</span> <span class=\"token operator\">NOT</span> <span class=\"token keyword\">EXISTS</span> test_db<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">-- Create table</span>\n<span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token operator\">NOT</span> <span class=\"token keyword\">EXISTS</span> t1 <span class=\"token punctuation\">(</span>\n    id <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">primary</span> <span class=\"token keyword\">key</span> <span class=\"token keyword\">auto_increment</span><span class=\"token punctuation\">,</span>\n    uname <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    comments <span class=\"token keyword\">text</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>User Management</h3>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token comment\">-- Create users</span>\n<span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">USER</span> <span class=\"token keyword\">IF</span> <span class=\"token operator\">NOT</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token string\">'local_user1'</span><span class=\"token variable\">@'localhost'</span> IDENTIFIED <span class=\"token keyword\">BY</span> <span class=\"token string\">'mypass'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">USER</span> <span class=\"token keyword\">IF</span> <span class=\"token operator\">NOT</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token string\">'remote_user1'</span><span class=\"token variable\">@'%'</span> IDENTIFIED <span class=\"token keyword\">BY</span> <span class=\"token string\">'mypass'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">-- Modify users</span>\n<span class=\"token keyword\">RENAME</span> <span class=\"token keyword\">USER</span> <span class=\"token string\">'abc'</span><span class=\"token variable\">@'localhost'</span> <span class=\"token keyword\">TO</span> <span class=\"token string\">'xyz'</span><span class=\"token variable\">@'%'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">ALTER</span> <span class=\"token keyword\">USER</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token string\">'remote_user1'</span><span class=\"token variable\">@'%'</span> IDENTIFIED <span class=\"token keyword\">BY</span> <span class=\"token string\">'mypass'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">ALTER</span> <span class=\"token keyword\">USER</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token string\">'remote_user1'</span><span class=\"token variable\">@'%'</span> PASSWORD EXPIRE<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">ALTER</span> <span class=\"token keyword\">USER</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token string\">'remote_user1'</span><span class=\"token variable\">@'%'</span> ACCOUNT <span class=\"token keyword\">LOCK</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>Privilege Management</h3>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token comment\">-- Grant examples</span>\n<span class=\"token keyword\">GRANT</span> <span class=\"token keyword\">ALL</span> <span class=\"token keyword\">PRIVILEGES</span> <span class=\"token keyword\">ON</span> db1<span class=\"token punctuation\">.</span><span class=\"token operator\">*</span> <span class=\"token keyword\">TO</span> <span class=\"token string\">'remote_user1'</span><span class=\"token variable\">@'%'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">GRANT</span> <span class=\"token keyword\">SELECT</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">INSERT</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">UPDATE</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">DELETE</span> <span class=\"token keyword\">ON</span> db1<span class=\"token punctuation\">.</span><span class=\"token operator\">*</span> <span class=\"token keyword\">TO</span> <span class=\"token string\">'remote_user1'</span><span class=\"token variable\">@'%'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">GRANT</span> <span class=\"token keyword\">SELECT</span> <span class=\"token keyword\">ON</span> db1<span class=\"token punctuation\">.</span>table1 <span class=\"token keyword\">TO</span> <span class=\"token string\">'remote_user1'</span><span class=\"token variable\">@'%'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">-- Check privileges</span>\n<span class=\"token keyword\">SHOW</span> GRANTS <span class=\"token keyword\">FOR</span> <span class=\"token string\">'remote_user1'</span><span class=\"token variable\">@'%'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Monitoring</h2>\n<h3>Database Size</h3>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> \n    table_schema <span class=\"token string\">\"Database Name\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">sum</span><span class=\"token punctuation\">(</span>data_length <span class=\"token operator\">+</span> index_length<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">1024</span> <span class=\"token operator\">/</span> <span class=\"token number\">1024</span> <span class=\"token string\">\"Database Size in MB\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">sum</span><span class=\"token punctuation\">(</span>data_free<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">1024</span> <span class=\"token operator\">/</span> <span class=\"token number\">1024</span> <span class=\"token string\">\"Free Space in MB\"</span>\n<span class=\"token keyword\">FROM</span> information_schema<span class=\"token punctuation\">.</span><span class=\"token keyword\">TABLES</span>\n<span class=\"token keyword\">GROUP</span> <span class=\"token keyword\">BY</span> table_schema<span class=\"token punctuation\">;</span></code></pre></div>\n<h3>Active Sessions</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">SHOW PROCESSLIST<span class=\"token punctuation\">;</span></code></pre></div>\n<h3>InnoDB Engine Status:</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">SHOW STATUS<span class=\"token punctuation\">;</span>\n\nSHOW ENGINE INNODB STATUS<span class=\"token punctuation\">;</span></code></pre></div>\n<h3>Performance schema: Live statistics</h3>\n<p>Example:</p>\n<ul>\n<li>Enable Locking related instruments (if it’s not enabled):</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">UPDATE</span> performance_schema<span class=\"token punctuation\">.</span>setup_instruments <span class=\"token keyword\">SET</span> ENABLED<span class=\"token operator\">=</span>’YES’<span class=\"token punctuation\">,</span> TIMED<span class=\"token operator\">=</span>’YES’ <span class=\"token keyword\">WHERE</span> NAME<span class=\"token operator\">=</span>’wait<span class=\"token operator\">/</span><span class=\"token keyword\">lock</span><span class=\"token operator\">/</span>metadata<span class=\"token operator\">/</span><span class=\"token keyword\">sql</span><span class=\"token operator\">/</span>mdl’<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">FROM</span> performance_schema<span class=\"token punctuation\">.</span>metadata_locks <span class=\"token keyword\">WHERE</span> OBJECT_SCHEMA<span class=\"token operator\">=</span>’test’ <span class=\"token operator\">AND</span> OBJECT_NAME <span class=\"token operator\">LIKE</span> ‘t_’<span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h3>Check Database objects info:</h3>\n<h4>Show Databases:</h4>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">SHOW DATABASES<span class=\"token punctuation\">;</span></code></pre></div>\n<h4>Select Database:</h4>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">Use db_name<span class=\"token punctuation\">;</span></code></pre></div>\n<h4>Tables:</h4>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">SHOW TABLES<span class=\"token punctuation\">;</span>\n\nSELECT TABLE_NAME from information_schema.TABLES where TABLE_SCHEMA <span class=\"token operator\">=</span> <span class=\"token string\">'test_db'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h4>Routines:</h4>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">select</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">from</span> ROUTINES <span class=\"token keyword\">where</span> ROUTINE_SCHEMA<span class=\"token operator\">=</span>'db_name’<span class=\"token punctuation\">;</span></code></pre></div>\n<h4>Index:</h4>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">select</span> TABLE_NAME<span class=\"token punctuation\">,</span>INDEX_NAME<span class=\"token punctuation\">,</span>COLUMN_NAME<span class=\"token punctuation\">,</span>INDEX_TYPE  <span class=\"token keyword\">from</span> information_schema<span class=\"token punctuation\">.</span><span class=\"token keyword\">STATISTICS</span> <span class=\"token keyword\">where</span> TABLE_SCHEMA <span class=\"token operator\">=</span> <span class=\"token string\">'db_name'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h4>Views:</h4>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">select</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">from</span> information_schema<span class=\"token punctuation\">.</span>VIEWS <span class=\"token keyword\">where</span> TABLE_SCHEMA <span class=\"token operator\">=</span> <span class=\"token string\">'db_name'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Backup and Restore</h2>\n<blockquote>\n<p><code class=\"language-text\">Require privileges</code>: mysqldump requires at least the <code class=\"language-text\">SELECT</code> privilege for dumped tables, <code class=\"language-text\">SHOW VIEW</code> for dumped views, <code class=\"language-text\">TRIGGER</code> for dumped triggers, and <code class=\"language-text\">LOCK TABLES</code> if the –single-transaction option is not used. Certain options might require other privileges as noted in the option descriptions. <a href=\"http://dev.mysql.com/doc/refman/5.7/en/mysqldump.html\">Reference</a></p>\n</blockquote>\n<h3>Backup Commands</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># Full database backup</span>\nmysqldump -u root -p --single-transaction --databases db1 --routines <span class=\"token operator\">></span> db1_fullbkp.sql\n\n<span class=\"token comment\"># Compressed full database backup</span>\nmysqldump -u root -p --single-transaction --databases db1 --routines <span class=\"token operator\">|</span> <span class=\"token function\">gzip</span> <span class=\"token operator\">></span> db1_fullbkp.sql.gz</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># Single table backup</span>\nmysqldump -u  -h  -p --single-transaction db_name table_name --routines <span class=\"token operator\">></span> db1_full.sql</code></pre></div>\n<h3>Restore Commands</h3>\n<p>To reload a dump file, you must have the privileges required to execute the statements that it contains, such as the appropriate <code class=\"language-text\">CREATE</code> privileges for objects created by those statements.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">mysql -u username -p db_name <span class=\"token operator\">&lt;</span> db1_fullbkp.sql\n<span class=\"token comment\"># OR for compressed files</span>\ngunzip <span class=\"token operator\">&lt;</span> db1_fullbkp.sql.gz <span class=\"token operator\">|</span> mysql -u username -p db_name</code></pre></div>\n<h2>Replication Setup</h2>\n<h3>Master Configuration</h3>\n<p>Create replication user on MASTER with replication privileges.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">USER</span> <span class=\"token keyword\">IF</span> <span class=\"token operator\">NOT</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token string\">'rpluser'</span><span class=\"token variable\">@'%'</span> IDENTIFIED <span class=\"token keyword\">BY</span> <span class=\"token string\">'rpluser1234'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">GRANT</span> <span class=\"token keyword\">REPLICATION</span> SLAVE<span class=\"token punctuation\">,</span> <span class=\"token keyword\">REPLICATION</span> CLIENT <span class=\"token keyword\">ON</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">.</span><span class=\"token operator\">*</span> <span class=\"token keyword\">TO</span> <span class=\"token string\">'rpluser'</span><span class=\"token variable\">@'%'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>Slave Configuration</h3>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">CHANGE MASTER <span class=\"token keyword\">TO</span>\n    MASTER_HOST<span class=\"token operator\">=</span><span class=\"token string\">'&lt;MASTER_IP>'</span><span class=\"token punctuation\">,</span>\n    MASTER_USER<span class=\"token operator\">=</span><span class=\"token string\">'rpluser'</span><span class=\"token punctuation\">,</span>\n    MASTER_PASSWORD<span class=\"token operator\">=</span><span class=\"token string\">'rpluser1234'</span><span class=\"token punctuation\">,</span>\n    MASTER_PORT<span class=\"token operator\">=</span><span class=\"token number\">3306</span><span class=\"token punctuation\">,</span>\n    MASTER_AUTO_POSITION<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>Start Slave and check its status</h3>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">START</span> SLAVE<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">SHOW</span> SLAVE <span class=\"token keyword\">STATUS</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token operator\">></span> Slave_IO_Running <span class=\"token operator\">and</span> Slave_SQL_Running <span class=\"token keyword\">column</span> <span class=\"token keyword\">value</span> should be ‘YES’</code></pre></div>\n<h2>Service Management (Linux)</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># Stop MySQL</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">service</span> mysqld stop\n\n<span class=\"token comment\"># Start MySQL</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">service</span> mysqld start</code></pre></div>","frontmatter":{"title":"Best practices for general MySql administration","date":"December 25, 2024","description":"","coverImage":"/assets/images/posts/covers/mysql-logo.jpg"}},"previous":{"fields":{"slug":"/how-to-create-blog-azure-static-web-app/"},"frontmatter":{"title":"How to create a personal blog using Azure Static Web App & Gatsby"}},"next":null},"pageContext":{"id":"f1386922-958a-5b23-91b9-cb9d24461421","previousPostId":"86708dc3-76d0-507a-94c2-70349ca80f58","nextPostId":null}},"staticQueryHashes":["2114561082","2841359383"],"slicesMap":{}}